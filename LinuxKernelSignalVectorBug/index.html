


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Personal fork of Go Programming Language Wiki">
      
      
        <link rel="canonical" href="https://zchee.github.io/golang-wiki/LinuxKernelSignalVectorBug/">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>LinuxKernelSignalVectorBug - Go Programming Language Wiki</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-89201129-1","https://zchee.github.io/golang-wiki/"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://zchee.github.io/golang-wiki/" title="Go Programming Language Wiki" class="md-header-nav__button md-logo" aria-label="Go Programming Language Wiki">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Go Programming Language Wiki
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              LinuxKernelSignalVectorBug
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/zchee/golang-wiki/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zchee/golang-wiki
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://zchee.github.io/golang-wiki/" title="Go Programming Language Wiki" class="md-nav__button md-logo" aria-label="Go Programming Language Wiki">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Go Programming Language Wiki
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/zchee/golang-wiki/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zchee/golang-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../Home/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      WhyGo
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="WhyGo" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        WhyGo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../WhyGo/" title="WhyGo" class="md-nav__link">
      WhyGo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Install
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Install" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Install
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ubuntu/" title="Ubuntu" class="md-nav__link">
      Ubuntu
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../InstallFromSource/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Articles/" title="Articles" class="md-nav__link">
      Articles
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../AssemblyPolicy/" title="AssemblyPolicy" class="md-nav__link">
      AssemblyPolicy
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../AVX512/" title="AVX512" class="md-nav__link">
      AVX512
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Benchmarks/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Blogs/" title="Blogs" class="md-nav__link">
      Blogs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Books/" title="Books" class="md-nav__link">
      Books
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../BoundingResourceUse/" title="BoundingResourceUse" class="md-nav__link">
      BoundingResourceUse
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cgo/" title="cgo" class="md-nav__link">
      cgo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ChromeOS/" title="ChromeOS" class="md-nav__link">
      ChromeOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CodeReview/" title="CodeReview" class="md-nav__link">
      CodeReview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CodeReviewComments/" title="CodeReviewComments" class="md-nav__link">
      CodeReviewComments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CodeTools/" title="CodeTools" class="md-nav__link">
      CodeTools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Comments/" title="Comments" class="md-nav__link">
      Comments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CommitMessage/" title="CommitMessage" class="md-nav__link">
      CommitMessage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CommonMistakes/" title="CommonMistakes" class="md-nav__link">
      CommonMistakes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CompilerOptimizations/" title="CompilerOptimizations" class="md-nav__link">
      CompilerOptimizations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Conferences/" title="Conferences" class="md-nav__link">
      Conferences
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Configuring-GoLand-for-WebAssembly/" title="Configuring-GoLand-for-WebAssembly" class="md-nav__link">
      Configuring-GoLand-for-WebAssembly
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Contributing-to-gopls/" title="Contributing-to-gopls" class="md-nav__link">
      Contributing-to-gopls
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CoreDumpDebugging/" title="CoreDumpDebugging" class="md-nav__link">
      CoreDumpDebugging
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Courses/" title="Courses" class="md-nav__link">
      Courses
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CreatingSubRepository/" title="CreatingSubRepository" class="md-nav__link">
      CreatingSubRepository
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CSSStyleGuide/" title="CSSStyleGuide" class="md-nav__link">
      CSSStyleGuide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CustomPprofProfiles/" title="CustomPprofProfiles" class="md-nav__link">
      CustomPprofProfiles
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Darwin/" title="Darwin" class="md-nav__link">
      Darwin
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../DashboardBuilders/" title="DashboardBuilders" class="md-nav__link">
      DashboardBuilders
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Deprecated/" title="Deprecated" class="md-nav__link">
      Deprecated
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../DesignDocuments/" title="DesignDocuments" class="md-nav__link">
      DesignDocuments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../DevExp/" title="DevExp" class="md-nav__link">
      DevExp
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Diagnostics/" title="Diagnostics" class="md-nav__link">
      Diagnostics
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../DragonFly-BSD/" title="DragonFly-BSD" class="md-nav__link">
      DragonFly-BSD
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ErrorValueFAQ/" title="ErrorValueFAQ" class="md-nav__link">
      ErrorValueFAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ExperienceReports/" title="ExperienceReports" class="md-nav__link">
      ExperienceReports
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../FileTreeDocumentation/" title="FileTreeDocumentation" class="md-nav__link">
      FileTreeDocumentation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../FreeBSD/" title="FreeBSD" class="md-nav__link">
      FreeBSD
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../FromXToGo/" title="FromXToGo" class="md-nav__link">
      FromXToGo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Frozen/" title="Frozen" class="md-nav__link">
      Frozen
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Gardening/" title="Gardening" class="md-nav__link">
      Gardening
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GccgoCrossCompilation/" title="GccgoCrossCompilation" class="md-nav__link">
      GccgoCrossCompilation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GcToolchainTricks/" title="GcToolchainTricks" class="md-nav__link">
      GcToolchainTricks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GerritAccess/" title="GerritAccess" class="md-nav__link">
      GerritAccess
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GerritBot/" title="GerritBot" class="md-nav__link">
      GerritBot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GithubAccess/" title="GithubAccess" class="md-nav__link">
      GithubAccess
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GitHubCodeLayout/" title="GitHubCodeLayout" class="md-nav__link">
      GitHubCodeLayout
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go-1.10-Release-Party/" title="Go-1.10-Release-Party" class="md-nav__link">
      Go-1.10-Release-Party
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go-1.6-release-party/" title="Go-1.6-release-party" class="md-nav__link">
      Go-1.6-release-party
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go-1.8-Release-Party/" title="Go-1.8-Release-Party" class="md-nav__link">
      Go-1.8-Release-Party
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go-Community-Slides/" title="Go-Community-Slides" class="md-nav__link">
      Go-Community-Slides
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go-Release-Cycle/" title="Go-Release-Cycle" class="md-nav__link">
      Go-Release-Cycle
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go1point1Gotchas/" title="Go1point1Gotchas" class="md-nav__link">
      Go1point1Gotchas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go2/" title="Go2" class="md-nav__link">
      Go2
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go2ErrorHandlingFeedback/" title="Go2ErrorHandlingFeedback" class="md-nav__link">
      Go2ErrorHandlingFeedback
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go2ErrorValuesFeedback/" title="Go2ErrorValuesFeedback" class="md-nav__link">
      Go2ErrorValuesFeedback
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Go2GenericsFeedback/" title="Go2GenericsFeedback" class="md-nav__link">
      Go2GenericsFeedback
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoArm/" title="GoArm" class="md-nav__link">
      GoArm
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoForCPPProgrammers/" title="GoForCPPProgrammers" class="md-nav__link">
      GoForCPPProgrammers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoGenerateTools/" title="GoGenerateTools" class="md-nav__link">
      GoGenerateTools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoGetProxyConfig/" title="GoGetProxyConfig" class="md-nav__link">
      GoGetProxyConfig
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoGetTools/" title="GoGetTools" class="md-nav__link">
      GoGetTools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../golang-tools/" title="golang-tools" class="md-nav__link">
      golang-tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoMips/" title="GoMips" class="md-nav__link">
      GoMips
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Gomote/" title="Gomote" class="md-nav__link">
      Gomote
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GOPATH/" title="GOPATH" class="md-nav__link">
      GOPATH
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Gopher/" title="Gopher" class="md-nav__link">
      Gopher
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../gopherbot/" title="gopherbot" class="md-nav__link">
      gopherbot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../gopls-integrator-FAQ/" title="gopls-integrator-FAQ" class="md-nav__link">
      gopls-integrator-FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../gopls/" title="gopls" class="md-nav__link">
      gopls
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoStrings/" title="GoStrings" class="md-nav__link">
      GoStrings
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoTalks/" title="GoTalks" class="md-nav__link">
      GoTalks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoUserGroups/" title="GoUserGroups" class="md-nav__link">
      GoUserGroups
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoUsers/" title="GoUsers" class="md-nav__link">
      GoUsers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GoVsGenerics/" title="GoVsGenerics" class="md-nav__link">
      GoVsGenerics
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../HandlingIssues/" title="HandlingIssues" class="md-nav__link">
      HandlingIssues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Hashing/" title="Hashing" class="md-nav__link">
      Hashing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../heapdump13/" title="heapdump13" class="md-nav__link">
      heapdump13
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../heapdump14/" title="heapdump14" class="md-nav__link">
      heapdump14
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../heapdump15-through-heapdump17/" title="heapdump15-through-heapdump17" class="md-nav__link">
      heapdump15-through-heapdump17
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../heapdump15/" title="heapdump15" class="md-nav__link">
      heapdump15
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../HostedContinuousIntegration/" title="HostedContinuousIntegration" class="md-nav__link">
      HostedContinuousIntegration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../How-to-ask-for-help/" title="How-to-ask-for-help" class="md-nav__link">
      How-to-ask-for-help
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../HowToAsk/" title="HowToAsk" class="md-nav__link">
      HowToAsk
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../HttpFetch/" title="HttpFetch" class="md-nav__link">
      HttpFetch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../HttpStaticFiles/" title="HttpStaticFiles" class="md-nav__link">
      HttpStaticFiles
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../IDEsAndTextEditorPlugins/" title="IDEsAndTextEditorPlugins" class="md-nav__link">
      IDEsAndTextEditorPlugins
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../InstallFromSource/" title="InstallFromSource" class="md-nav__link">
      InstallFromSource
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../InstallTroubleshooting/" title="InstallTroubleshooting" class="md-nav__link">
      InstallTroubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../InterfaceSlice/" title="InterfaceSlice" class="md-nav__link">
      InterfaceSlice
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../InvalidFlag/" title="InvalidFlag" class="md-nav__link">
      InvalidFlag
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Iota/" title="Iota" class="md-nav__link">
      Iota
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../IssueLabels/" title="IssueLabels" class="md-nav__link">
      IssueLabels
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Learn/" title="Learn" class="md-nav__link">
      Learn
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../LearnConcurrency/" title="LearnConcurrency" class="md-nav__link">
      LearnConcurrency
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../LearnErrorHandling/" title="LearnErrorHandling" class="md-nav__link">
      LearnErrorHandling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../LearnServerProgramming/" title="LearnServerProgramming" class="md-nav__link">
      LearnServerProgramming
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../LearnTesting/" title="LearnTesting" class="md-nav__link">
      LearnTesting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="LinuxKernelSignalVectorBug" class="md-nav__link md-nav__link--active">
      LinuxKernelSignalVectorBug
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../LockOSThread/" title="LockOSThread" class="md-nav__link">
      LockOSThread
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../MethodSets/" title="MethodSets" class="md-nav__link">
      MethodSets
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../MinimumRequirements/" title="MinimumRequirements" class="md-nav__link">
      MinimumRequirements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../MinorReleases/" title="MinorReleases" class="md-nav__link">
      MinorReleases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Mobile/" title="Mobile" class="md-nav__link">
      Mobile
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Modules/" title="Modules" class="md-nav__link">
      Modules
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../MultipleGoRoots/" title="MultipleGoRoots" class="md-nav__link">
      MultipleGoRoots
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../MutexOrChannel/" title="MutexOrChannel" class="md-nav__link">
      MutexOrChannel
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../NativeClient/" title="NativeClient" class="md-nav__link">
      NativeClient
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../NetBSD/" title="NetBSD" class="md-nav__link">
      NetBSD
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../NewSpeakers/" title="NewSpeakers" class="md-nav__link">
      NewSpeakers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../NoMeToo/" title="NoMeToo" class="md-nav__link">
      NoMeToo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../NonEnglish/" title="NonEnglish" class="md-nav__link">
      NonEnglish
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../NoPlusOne/" title="NoPlusOne" class="md-nav__link">
      NoPlusOne
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../OlderVersions/" title="OlderVersions" class="md-nav__link">
      OlderVersions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../OpenBSD/" title="OpenBSD" class="md-nav__link">
      OpenBSD
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../PackageManagementTools/" title="PackageManagementTools" class="md-nav__link">
      PackageManagementTools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../PackagePublishing/" title="PackagePublishing" class="md-nav__link">
      PackagePublishing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../PanicAndRecover/" title="PanicAndRecover" class="md-nav__link">
      PanicAndRecover
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../PerfDashboard/" title="PerfDashboard" class="md-nav__link">
      PerfDashboard
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Plan9/" title="Plan9" class="md-nav__link">
      Plan9
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Podcasts/" title="Podcasts" class="md-nav__link">
      Podcasts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../PortingPolicy/" title="PortingPolicy" class="md-nav__link">
      PortingPolicy
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../PriorDiscussion/" title="PriorDiscussion" class="md-nav__link">
      PriorDiscussion
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Projects/" title="Projects" class="md-nav__link">
      Projects
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Proposals/" title="Proposals" class="md-nav__link">
      Proposals
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ProviderIntegration/" title="ProviderIntegration" class="md-nav__link">
      ProviderIntegration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Questions/" title="Questions" class="md-nav__link">
      Questions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../RaceDetector/" title="RaceDetector" class="md-nav__link">
      RaceDetector
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Range/" title="Range" class="md-nav__link">
      Range
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../RateLimiting/" title="RateLimiting" class="md-nav__link">
      RateLimiting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Rationales/" title="Rationales" class="md-nav__link">
      Rationales
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ResearchPapers/" title="ResearchPapers" class="md-nav__link">
      ResearchPapers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Resolving-Problems-From-Modified-Module-Path/" title="Resolving-Problems-From-Modified-Module-Path" class="md-nav__link">
      Resolving-Problems-From-Modified-Module-Path
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Screencasts/" title="Screencasts" class="md-nav__link">
      Screencasts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SendingMail/" title="SendingMail" class="md-nav__link">
      SendingMail
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SettingGOPATH/" title="SettingGOPATH" class="md-nav__link">
      SettingGOPATH
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SignalHandling/" title="SignalHandling" class="md-nav__link">
      SignalHandling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SimultaneousAssignment/" title="SimultaneousAssignment" class="md-nav__link">
      SimultaneousAssignment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SliceTricks/" title="SliceTricks" class="md-nav__link">
      SliceTricks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SlowBots/" title="SlowBots" class="md-nav__link">
      SlowBots
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Solaris/" title="Solaris" class="md-nav__link">
      Solaris
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Spelling/" title="Spelling" class="md-nav__link">
      Spelling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SQLDrivers/" title="SQLDrivers" class="md-nav__link">
      SQLDrivers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SQLInterface/" title="SQLInterface" class="md-nav__link">
      SQLInterface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Style/" title="Style" class="md-nav__link">
      Style
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SubRepositories/" title="SubRepositories" class="md-nav__link">
      SubRepositories
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SuccessStories/" title="SuccessStories" class="md-nav__link">
      SuccessStories
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Switch/" title="Switch" class="md-nav__link">
      Switch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../TableDrivenTests/" title="TableDrivenTests" class="md-nav__link">
      TableDrivenTests
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../TargetSpecific/" title="TargetSpecific" class="md-nav__link">
      TargetSpecific
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../TestComments/" title="TestComments" class="md-nav__link">
      TestComments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Timeouts/" title="Timeouts" class="md-nav__link">
      Timeouts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Training/" title="Training" class="md-nav__link">
      Training
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../vgo/" title="vgo" class="md-nav__link">
      vgo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../WebAccessibilityResourcesAndTips/" title="WebAccessibilityResourcesAndTips" class="md-nav__link">
      WebAccessibilityResourcesAndTips
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Well-known-struct-tags/" title="Well-known-struct-tags" class="md-nav__link">
      Well-known-struct-tags
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../windows-scoop-install-go-cli/" title="windows-scoop-install-go-cli" class="md-nav__link">
      windows-scoop-install-go-cli
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../WindowsBuild/" title="WindowsBuild" class="md-nav__link">
      WindowsBuild
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../WindowsCrossCompiling/" title="WindowsCrossCompiling" class="md-nav__link">
      WindowsCrossCompiling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../WindowsDLLs/" title="WindowsDLLs" class="md-nav__link">
      WindowsDLLs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zchee/golang-wiki/edit/master/docs/LinuxKernelSignalVectorBug.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="introduction">Introduction</h1>
<p>If you reached this page because of a message like this printed by a Go program:</p>
<div class="highlight"><pre><span></span><code>runtime: note: your Linux kernel may be buggy
runtime: note: see https://golang.org/wiki/LinuxKernelSignalVectorBug
runtime: note: mlock workaround for kernel bug failed with errno &lt;number&gt;
</code></pre></div>

<p>then you are using a Linux kernel that may have a bug.
This kernel bug may have caused memory corruption in your Go program, and may have caused your Go program to crash.</p>
<p>If you understand why your program crashed, then you can ignore this page.</p>
<p>Otherwise, this page will explain what the kernel bug is, and includes a C program that you can use to check whether your kernel has the bug.</p>
<h1 id="bug-description">Bug description</h1>
<p>A bug was introduced in Linux kernel version 5.2: if a signal is delivered to a thread, and delivering the signal requires faulting in pages of the thread signal stack, then AVX YMM registers may be corrupted upon returning from the signal to the program.
If the program was executing some function that uses the YMM registers, that function can behave unpredictably.</p>
<p>The bug only happens on systems with an x86 processor.
The bug affects programs written in any language.
The bug only affects programs that receive signals.
Among programs that receive signals, the bug is more likely to affect programs that use an alternate signal stack.
The bug only affects programs that use the YMM registers.
In Go programs in particular the bug will normally cause memory corruption, as Go programs primarily use the YMM registers to implement copying one memory buffer to another.</p>
<p>The bug <a href="https://bugzilla.kernel.org/show_bug.cgi?id=205663">was reported to the Linux kernel developers</a>.
It was quickly fixed.
The bug fix was not ported back to the Linux kernel 5.2 series.
The bug was fixed in Linux kernel versions 5.3.15, 5.4.2, and 5.5 and later.</p>
<p>The bug is only present if the kernel was compiled with GCC 9 or later.</p>
<p>The bug is present in vanilla Linux kernel versions 5.2.x for any x, 5.3.0 through 5.3.14, and 5.4.0 and 5.4.1.
However, many distros that are shipping those kernel versions have in fact backported the patch (which is very small).
And, some distros are still compiling their kernel with GCC 8, in which case the kernel does not have the bug.</p>
<p>In other words, even if your kernel is in the vulnerable range, there is a good chance that it is not vulnerable to the bug.</p>
<h1 id="bug-test">Bug test</h1>
<p>To test whether your kernel has the bug, you can run the following C program (click on "Details" to see the program).
On a buggy kernel, it will fail almost immediately.
On a kernel without the bug, it will run for 60 seconds and then exit with a 0 status.</p>
<details>

<div class="highlight"><pre><span></span><code><span class="c1">// Build with: gcc -pthread test.c</span>
<span class="c1">//</span>
<span class="c1">// This demonstrates an issue where AVX state becomes corrupted when a</span>
<span class="c1">// signal is delivered where the signal stack pages aren&#39;t faulted in.</span>
<span class="c1">//</span>
<span class="c1">// There appear to be three necessary ingredients, which are marked</span>
<span class="c1">// with &quot;!!!&quot; below:</span>
<span class="c1">//</span>
<span class="c1">// 1. A thread doing AVX operations using YMM registers.</span>
<span class="c1">//</span>
<span class="c1">// 2. A signal where the kernel must fault in stack pages to write the</span>
<span class="c1">//    signal context.</span>
<span class="c1">//</span>
<span class="c1">// 3. Context switches. Having a single task isn&#39;t sufficient.</span>

<span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/prctl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">sigs</span><span class="p">;</span>

<span class="k">static</span> <span class="n">stack_t</span> <span class="n">altstack</span><span class="p">;</span>
<span class="k">static</span> <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">err</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">unused</span><span class="p">)),</span>
             <span class="kt">siginfo_t</span><span class="o">*</span> <span class="n">info</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">unused</span><span class="p">)),</span>
             <span class="kt">void</span><span class="o">*</span> <span class="n">context</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">unused</span><span class="p">)))</span> <span class="p">{</span>
  <span class="n">sigs</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">sender</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
    <span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">pthread_kill</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">SIGWINCH</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">die</span><span class="p">(</span><span class="s">&quot;pthread_kill&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">dump</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s =&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">doAVX</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">output</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

  <span class="c1">// Set input to a known pattern.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span> <span class="n">input</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
  <span class="c1">// Mix our PID in so we detect cross-process leakage, though this</span>
  <span class="c1">// doesn&#39;t appear to be what&#39;s happening.</span>
  <span class="kt">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">getpid</span><span class="p">();</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pid</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">pid</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// !!! Do some computation we can check using YMM registers.</span>
      <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span>
        <span class="s">&quot;vmovdqu %1, %%ymm0;&quot;</span>
        <span class="s">&quot;vmovdqa %%ymm0, %%ymm1;&quot;</span>
        <span class="s">&quot;vmovdqa %%ymm1, %%ymm2;&quot;</span>
        <span class="s">&quot;vmovdqa %%ymm2, %%ymm3;&quot;</span>
        <span class="s">&quot;vmovdqu %%ymm3, %0;&quot;</span>
        <span class="o">:</span> <span class="s">&quot;=m&quot;</span> <span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="o">:</span> <span class="s">&quot;m&quot;</span> <span class="p">(</span><span class="n">input</span><span class="p">)</span>
        <span class="o">:</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;ymm0&quot;</span><span class="p">,</span> <span class="s">&quot;ymm1&quot;</span><span class="p">,</span> <span class="s">&quot;ymm2&quot;</span><span class="p">,</span> <span class="s">&quot;ymm3&quot;</span><span class="p">);</span>
      <span class="c1">// Check that input == output.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">input</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dump</span><span class="p">(</span><span class="s">&quot;input &quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
        <span class="n">dump</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
        <span class="n">die</span><span class="p">(</span><span class="s">&quot;mismatch&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// !!! Release the pages of the signal stack. This is necessary</span>
    <span class="c1">// because the error happens when copy_fpstate_to_sigframe enters</span>
    <span class="c1">// the failure path that handles faulting in the stack pages.</span>
    <span class="c1">// (mmap with MMAP_FIXED also works.)</span>
    <span class="c1">//</span>
    <span class="c1">// (We do this here to ensure it doesn&#39;t race with the signal</span>
    <span class="c1">// itself.)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">madvise</span><span class="p">(</span><span class="n">altstack</span><span class="p">.</span><span class="n">ss_sp</span><span class="p">,</span> <span class="n">altstack</span><span class="p">.</span><span class="n">ss_size</span><span class="p">,</span> <span class="n">MADV_DONTNEED</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">die</span><span class="p">(</span><span class="s">&quot;madvise&quot;</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">doTest</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create an alternate signal stack so we can release its pages.</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">altSigstack</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">SIGSTKSZ</span><span class="p">,</span> <span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">,</span> <span class="n">MAP_PRIVATE</span><span class="o">|</span><span class="n">MAP_ANONYMOUS</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">altSigstack</span> <span class="o">==</span> <span class="n">MAP_FAILED</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">&quot;mmap failed&quot;</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>
  <span class="n">altstack</span><span class="p">.</span><span class="n">ss_sp</span> <span class="o">=</span> <span class="n">altSigstack</span><span class="p">;</span>
  <span class="n">altstack</span><span class="p">.</span><span class="n">ss_size</span> <span class="o">=</span> <span class="n">SIGSTKSZ</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">sigaltstack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">altstack</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">&quot;sigaltstack&quot;</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>

  <span class="c1">// Install SIGWINCH handler.</span>
  <span class="k">struct</span> <span class="n">sigaction</span> <span class="n">sa</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">sa_sigaction</span> <span class="o">=</span> <span class="n">handler</span><span class="p">,</span>
    <span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="n">SA_ONSTACK</span> <span class="o">|</span> <span class="n">SA_RESTART</span><span class="p">,</span>
  <span class="p">};</span>
  <span class="n">sigfillset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sa</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGWINCH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sa</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">&quot;sigaction&quot;</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>

  <span class="c1">// Start thread to send SIGWINCH.</span>
  <span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
  <span class="n">pthread_t</span> <span class="n">ctid</span><span class="p">;</span>
  <span class="n">tid</span> <span class="o">=</span> <span class="n">pthread_self</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">&quot;pthread_create sender&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>

  <span class="c1">// Run test.</span>
  <span class="n">doAVX</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">exiter</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
  <span class="n">pthread_t</span> <span class="n">ctid</span><span class="p">;</span>

  <span class="c1">// !!! We need several processes to cause context switches. Threads</span>
  <span class="c1">// probably also work. I don&#39;t know if the other tasks also need to</span>
  <span class="c1">// be doing AVX operations, but here we do.</span>
  <span class="kt">int</span> <span class="n">nproc</span> <span class="o">=</span> <span class="n">sysconf</span><span class="p">(</span><span class="n">_SC_NPROCESSORS_ONLN</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nproc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">pid_t</span> <span class="n">child</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">child</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">die</span><span class="p">(</span><span class="s">&quot;fork failed&quot;</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">child</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Exit if the parent dies.</span>
      <span class="n">prctl</span><span class="p">(</span><span class="n">PR_SET_PDEATHSIG</span><span class="p">,</span> <span class="n">SIGKILL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">doTest</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Exit after a while.</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">exiter</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">&quot;pthread_create exiter&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>

  <span class="c1">// Wait for a failure.</span>
  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">status</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">&quot;wait&quot;</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">&quot;child unexpectedly exited with success&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;child process failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h1 id="what-to-do">What to do</h1>
<p>If your kernel version is in the range that may contain the bug, run the C program above to see if it fails.
If it fails, your kernel is buggy.
You should upgrade to a newer kernel.
There is no workaround for this bug.</p>
<p>Go programs built with 1.14 will attempt to mitigate the bug by using the <code>mlock</code> system call to lock the signal stack page into memory.
This works because the bug only occurs if the signal stack page has to be faulted in.
However, this use of <code>mlock</code> can fail.
If you see the message</p>
<div class="highlight"><pre><span></span><code>runtime: note: mlock workaround for kernel bug failed with errno 12
</code></pre></div>

<p>the <code>errno 12</code> (also known as <code>ENOMEM</code>) means that <code>mlock</code> failed because the system set a limit on the amount of memory that a program can lock.
If you can increase the limit, the program may succeed.
This is done using <code>ulimit -l</code>.
When running a program in a docker container, you can increase the limit by invoking docker with the option <code>-ulimit memlock=67108864</code>.</p>
<p>If you cannot increase the <code>mlock</code> limit, then you can make the bug less likely to interfere with your program by setting the environment variable <code>GODEBUG=asyncpreemptoff=1</code> when running a Go program.
However, this just makes your program less likely to suffer memory corruption (because it reduces the number of signals that your program will receive).
The bug is still present, and memory corruption may still occur.</p>
<h1 id="questions">Questions?</h1>
<p>Ask on the mailing list <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#103;&#111;&#108;&#97;&#110;&#103;&#45;&#110;&#117;&#116;&#115;&#64;&#103;&#111;&#111;&#103;&#108;&#101;&#103;&#114;&#111;&#117;&#112;&#115;&#46;&#99;&#111;&#109;">&#103;&#111;&#108;&#97;&#110;&#103;&#45;&#110;&#117;&#116;&#115;&#64;&#103;&#111;&#111;&#103;&#108;&#101;&#103;&#114;&#111;&#117;&#112;&#115;&#46;&#99;&#111;&#109;</a>, or on any Go forum as described at <a href="https://golang.org/wiki/Questions">Questions</a>.</p>
<h1 id="details">Details</h1>
<p>To see more details on how the bug affects Go programs and how it was detected and understood, see <a href="https://golang.org/issue/35777">#35777</a> and <a href="https://golang.org/issue/35326">#35326</a>.</p>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: March 13, 2020
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../Linux/" title="Linux" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Linux
              </div>
            </div>
          </a>
        
        
          <a href="../LockOSThread/" title="LockOSThread" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                LockOSThread
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.5/es5/startup.js"></script>
      
    
  </body>
</html>